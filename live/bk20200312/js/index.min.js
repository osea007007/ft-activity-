"use strict";function _asyncToGenerator(e){return function(){var a=e.apply(this,arguments);return new Promise(function(s,o){return function t(e,n){try{var r=a[e](n),i=r.value}catch(e){return void o(e)}if(!r.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});s(i)}("next")})}}Vue.use(window.vuelidate.default),Vue.use(VueScrollTo);var front={mixins:[valid,window.lineEvent],data:function(){return{config:{event_id:"D2446",event_code:"live",discount_code:"Live202002",end_date:"2020-03-11",uid:"",t:"",hash:"",isBinded:999},isSubmit:!1,isDone:!1,loginType:2,temp:{ID_NO:"",BF_NAME:"",CELL_PHONE:"",EMAIL:""},form:{ID_NO:"",PASS_WORD:"",BF_NAME:"",CELL_PHONE:"",EMAIL:"",AGREE:!1}}},computed:{login_id_no:{get:function(){return this.form.ID_NO},set:function(e){this.form.ID_NO=e?e.toUpperCase():""}},covered_id_no:function(){var e="";return this.form.ID_NO&&(e=this.form.ID_NO.substr(0,3)+"XXXXX"+this.form.ID_NO.substr(8,10)),e},event_url:function(){return this.testMode?"https://line.franklin.com.tw:8688/bcsweb/l/15":"https://line.franklin.com.tw/bcsweb/l/93"},isLine:function(){return"linem"==this.getQueryParams().utm_source},loginData:function(){return{ID_NO:this.form.ID_NO,PASSWD:md5(this.form.PASS_WORD)}},wf09Data:function(){var e={Event_Id:this.config.event_id,IsRepeatable:"N"};return this.getQueryParams().utm_source&&(e.utm_source=this.getQueryParams().utm_source),this.isLine&&(e.uid=this.config.uid),1==this.config.isBinded?e.Identification="":(e.Identification=this.form.ID_NO==this.temp.ID_NO?"":this.form.ID_NO,1==this.loginType?e.Event_Other="-1":2==this.loginType&&(e.Friend_Name=this.form.BF_NAME==this.temp.BF_NAME?"":this.form.BF_NAME,e.Email=this.form.EMAIL==this.temp.EMAIL?"":this.form.EMAIL,e.M_Tel=this.form.CELL_PHONE==this.temp.CELL_PHONE?"":this.form.CELL_PHONE)),e},disData:function(){return{ID_NO:this.form.ID_NO,CELL_PHONE:this.form.CELL_PHONE,BF_NAME:this.form.BF_NAME,EMAIL:this.form.EMAIL,AGREE:this.form.AGREE?"Y":""}},isEnd:function(){return moment(new Date).isSameOrAfter(this.config.end_date)}},created:function(){var e=this;this.isEnd?location.href="https://event.franklin.com.tw/activityEnds/event-end.html":this.$nextTick(function(){e.isLine&&!e.isEnd&&e.checkLineParams()})},methods:{resetData:function(){this.form.ID_NO="",this.form.PASS_WORD="",this.form.BF_NAME="",this.form.CELL_PHONE="",this.form.EMAIL="",this.form.AGREE=!1,this.$v.form.$reset()},changeLoginType:function(e){1!=this.config.isBinded&&(this.loginType=e,this.resetData())},checkLineParams:function(){var e=this;this.checkParams(this.config.event_code,function(){e.getInfo(),e.testLog("url","https://wt.franklin.com.tw/areas/"+e.config.event_code+"/index.html?utm_source="+e.getQueryParams().utm_source+"&uid="+e.config.uid+"&t="+e.config.t+"&hash="+e.config.hash)})},getInfo:function(){var s=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.isSubmit){e.next=2;break}return e.abrupt("return");case 2:return s.isSubmit=!0,e.prev=3,e.prev=4,e.next=7,s.getLineVerify({uid:s.config.uid,timestamp:s.config.t,hash:s.config.hash});case 7:if(t=e.sent,s.testLog("verify",t),!t){e.next=19;break}return e.next=12,s.getBinded_2({CodeSecret:md5(s.config.uid+"D2444"),UID:s.config.uid});case 12:n=e.sent,s.testLog("bind",n),r=[1,2,4],s.config.isBinded=-1<r.indexOf(n.status)?n.status:4,s.$nextTick(function(){1==s.config.isBinded?s.form.ID_NO=n.memo:2==s.config.isBinded&&(s.temp.ID_NO=n.memo||"",s.temp.BF_NAME=n.Friend_Name||"",s.temp.CELL_PHONE=n.M_Tel||"",s.temp.EMAIL=n.Email||"",s.form.ID_NO=n.memo||"",s.form.BF_NAME=n.Friend_Name||"",s.form.CELL_PHONE=n.M_Tel||"",s.form.EMAIL=n.Email||"")}),e.next=20;break;case 19:location.href=s.event_url;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(4),i=e.t0?e.t0:"\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01",s.throwError(i+" info",""+e.t0);case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(3),s.throwError("\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01 other",e.t1);case 31:return e.prev=31,s.isSubmit=!1,e.finish(31);case 34:case"end":return e.stop()}},e,s,[[3,28,31,34],[4,22]])}))()},sendForm:function(){var i=this;return _asyncToGenerator(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i.isEnd){e.next=3;break}return alert("\u6b64\u6d3b\u52d5\u5df2\u7d93\u7d50\u675f\uff0c\u672a\u4f86\u5c07\u4e0d\u5b9a\u671f\u63d0\u4f9b\u66f4\u591a\u6700\u5373\u6642\u7684\u5e02\u5834\u3001\u597d\u5eb7\u8a0a\u606f\uff0c\u8acb\u6301\u7e8c\u95dc\u6ce8\u6211\u5011\u5594\uff01"),e.abrupt("return");case 3:if(!i.$v.form.$invalid){e.next=8;break}i.$v.form.$touch(),i.$nextTick(function(){var e=document.querySelectorAll(".formArea-item.error")[0];i.$scrollTo(e)}),e.next=63;break;case 8:if(!i.isSubmit){e.next=10;break}return e.abrupt("return");case 10:return i.isSubmit=!0,e.next=13,new Promise(function(e){i.$nextTick(function(){setTimeout(function(){e()},333)})});case 13:if(e.prev=13,i.testLog("mode",i.isLine?"line":"basic"),1!=i.loginType){e.next=22;break}return e.next=18,i.getBCstatus(i.loginData);case 18:t=e.sent,i.testLog("login",t),e.next=23;break;case 22:t={rtcode:"0"};case 23:e.t0=t.rtcode,e.next="0"===e.t0?26:53;break;case 26:if(!i.isLine){e.next=32;break}return e.next=29,i.setQuestionWF09(i.wf09Data);case 29:e.t1=e.sent,e.next=35;break;case 32:return e.next=34,i.setNewWF09(i.wf09Data);case 34:e.t1=e.sent;case 35:if(n=e.t1,i.testLog((i.isLine?"line-":"")+"wf09",n),"1"!=n.status.toString()){e.next=51;break}return e.next=40,i.setDiscount(i.config.discount_code,i.disData);case 40:if(r=e.sent,i.testLog("dis",r),"0"!=r.rtcode.toString()){e.next=47;break}i.isDone=!0,i.$nextTick(function(){i.$scrollTo("#complete")}),e.next=49;break;case 47:return i.throwError(r.message,r),e.abrupt("return");case 49:e.next=52;break;case 51:i.throwError(n.memo,n);case 52:return e.abrupt("break",55);case 53:return i.throwError(t.message,t),e.abrupt("break",55);case 55:e.next=60;break;case 57:e.prev=57,e.t2=e.catch(13),i.throwError("\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01",e.t2);case 60:return e.prev=60,i.isSubmit=!1,e.finish(60);case 63:case"end":return e.stop()}},e,i,[[13,57,60,63]])}))()},lineAlert:function(){alert("\u7533\u8acbLINE\u5b98\u65b9\u5e33\u865f\u7d81\u5b9a\u670d\u52d9\u6642\uff0c\u5bcc\u862d\u514b\u6797\u5c07\u6839\u64da\u4f60\u63d0\u4f9b\u7684\u59d3\u540d\u3001\u884c\u52d5\u96fb\u8a71\u8207LINE\u5e33\u865f\u9032\u884c\u8eab\u5206\u9a57\u8b49\uff0c\u672c\u67e5\u8a62\u53ca\u9a57\u8b49\u670d\u52d9\u65bc\u5bcc\u862d\u514b\u6797\u7cfb\u7d71\u57f7\u884c\uff0c\u4e0d\u6703\u7d93\u7531LINE\u8a18\u9304\u8cc7\u6599\u3002\n\n\u6210\u529f\u7d81\u5b9a\u500b\u4eba\u5316\u670d\u52d9\u5f8c\uff0c \u82e5\u66f4\u63db\u624b\u6a5f\u6216\u91cd\u65b0\u5b89\u88ddLINE APP\uff0c \u9700\u4ee5\u539f\u672cLINE ID\u767b\u5165\uff0c \u4ee5\u5229\u5f8c\u7e8cLINE\u500b\u4eba\u5316\u670d\u52d9\u4f7f\u7528\u3002 ")}}};