"use strict";function _asyncToGenerator(t){return function(){var a=t.apply(this,arguments);return new Promise(function(o,s){return function e(t,n){try{var i=a[t](n),r=i.value}catch(t){return void s(t)}if(!i.done)return Promise.resolve(r).then(function(t){e("next",t)},function(t){e("throw",t)});o(r)}("next")})}}Vue.use(window.vuelidate.default),Vue.use(VueScrollTo);var front={mixins:[valid,window.lineEvent],data:function(){return{config:{end_date:"2020-03-01",now:moment(new Date).format("YYYY-MM-DD HH:mm:ss"),step1:"2020-01-02 00:00:00",step2:"2020-02-03 00:00:00",event_id:"D2444",uid:"",t:"",hash:"",isBinded:999},isSubmit:!1,isDone:!1,loginType:2,temp:{ID_NO:"",BF_NAME:"",CELL_PHONE:"",EMAIL:""},form:{ID_NO:"",PASS_WORD:"",BF_NAME:"",CELL_PHONE:"",EMAIL:"",AGREE:!1},countdown:"00\u592900\u5c0f\u664200\u520600\u79d2"}},computed:{login_id_no:{get:function(){return this.form.ID_NO},set:function(t){this.form.ID_NO=t?t.toUpperCase():""}},covered_id_no:function(){var t="";return this.form.ID_NO&&(t=this.form.ID_NO.substr(0,3)+"XXXXX"+this.form.ID_NO.substr(8,10)),t},step:function(){return moment(this.config.now).isSameOrAfter(this.config.step2)?2:1},event_url:function(){return this.testMode?"https://line.franklin.com.tw:8688/bcsweb/l/13":"https://line.franklin.com.tw/bcsweb/l/"+(-1<location.href.indexOf("step2")?"84":"82")},isLine:function(){return"linem"==this.getQueryParams().utm_source},loginData:function(){return{ID_NO:this.form.ID_NO,PASSWD:md5(this.form.PASS_WORD)}},wf09Data:function(){var t={Event_Id:this.config.event_id,IsRepeatable:"N"};return this.getQueryParams().utm_source&&(t.utm_source=this.getQueryParams().utm_source),this.isLine&&(t.uid=this.config.uid),1==this.config.isBinded?t.Identification="":(t.Identification=this.form.ID_NO==this.temp.ID_NO?"":this.form.ID_NO,1==this.loginType?t.Event_Other="-1":2==this.loginType&&(t.Friend_Name=this.form.BF_NAME==this.temp.BF_NAME?"":this.form.BF_NAME,t.Email=this.form.EMAIL==this.temp.EMAIL?"":this.form.EMAIL,t.M_Tel=this.form.CELL_PHONE==this.temp.CELL_PHONE?"":this.form.CELL_PHONE)),t},disData:function(){return{ID_NO:this.form.ID_NO,CELL_PHONE:this.form.CELL_PHONE,BF_NAME:this.form.BF_NAME,EMAIL:this.form.EMAIL,AGREE:this.form.AGREE?"Y":""}},isEnd:function(){return!this.testMode&&moment(new Date).isSameOrAfter(this.config.end_date)}},created:function(){var t=this;(this.testMode||-1<location.href.indexOf("step2"))&&(this.config.step2="2019-12-25 09:37:00"),this.$nextTick(function(){1==t.step&&t.clock(),t.isLine&&2==t.step&&t.checkLineParams()})},mounted:function(){this.clock(),this.$nextTick(function(){document.querySelector(".banner").classList.add("active")})},methods:{resetData:function(){this.form.ID_NO="",this.form.PASS_WORD="",this.form.BF_NAME="",this.form.CELL_PHONE="",this.form.EMAIL="",this.form.AGREE=!1,this.$v.form.$reset()},test:function(t){this.config.step2=t,this.config.isBinded=999},changeType:function(t){this.config.isBinded=t},changeLoginType:function(t){1!=this.config.isBinded&&(this.loginType=t,this.resetData())},formatTens:function(t){return t<10?"0"+t:""+t},clock:function(){var e=this;$(".reciprocal").countdown(this.config.step2,{defer:null}).on("update.countdown",function(t){e.countdown=t.strftime("%D\u5929%H\u5c0f\u6642%M\u5206%S\u79d2")}).on("finish.countdown",function(){e.config.now=moment(new Date).format("YYYY-MM-DD HH:mm:ss"),e.countdown="00\u592900\u5c0f\u664200\u520600\u79d2",e.$nextTick(function(){e.isLine&&2==e.step&&e.checkLineParams()})}).countdown("start")},checkLineParams:function(){var t=this;this.checkParams("new-year",function(){t.getInfo(),t.testLog("url","https://wt.franklin.com.tw/areas/new-year/index.html?utm_source="+t.getQueryParams().utm_source+"&uid="+t.config.uid+"&t="+t.config.t+"&hash="+t.config.hash)})},getInfo:function(){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,i,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.isEnd&&!o.isSubmit){t.next=2;break}return t.abrupt("return");case 2:return o.isSubmit=!0,t.prev=3,t.prev=4,t.next=7,o.getLineVerify({uid:o.config.uid,timestamp:o.config.t,hash:o.config.hash});case 7:if(e=t.sent,o.testLog("verify",e),!e){t.next=19;break}return t.next=12,o.getBinded_2({CodeSecret:md5(o.config.uid+o.config.event_id),UID:o.config.uid});case 12:n=t.sent,o.testLog("bind",n),i=[1,2,4],o.config.isBinded=-1<i.indexOf(n.status)?n.status:4,o.$nextTick(function(){1==o.config.isBinded?o.form.ID_NO=n.memo:2==o.config.isBinded&&(o.temp.ID_NO=n.memo||"",o.temp.BF_NAME=n.Friend_Name||"",o.temp.CELL_PHONE=n.M_Tel||"",o.temp.EMAIL=n.Email||"",o.form.ID_NO=n.memo||"",o.form.BF_NAME=n.Friend_Name||"",o.form.CELL_PHONE=n.M_Tel||"",o.form.EMAIL=n.Email||"")}),t.next=20;break;case 19:location.href=o.event_url;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(4),r=t.t0?t.t0:"\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01",o.throwError(r+" info",""+t.t0);case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(3),o.throwError("\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01 other",t.t1);case 31:return t.prev=31,o.isSubmit=!1,t.finish(31);case 34:case"end":return t.stop()}},t,o,[[3,28,31,34],[4,22]])}))()},sendForm:function(){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.isEnd){t.next=2;break}return t.abrupt("return");case 2:if(!r.$v.form.$invalid){t.next=7;break}r.$v.form.$touch(),r.$nextTick(function(){var t=document.querySelectorAll(".formArea-item.error")[0];r.$scrollTo(t)}),t.next=62;break;case 7:if(!r.isSubmit){t.next=9;break}return t.abrupt("return");case 9:return r.isSubmit=!0,t.next=12,new Promise(function(t){r.$nextTick(function(){setTimeout(function(){t()},333)})});case 12:if(t.prev=12,r.testLog("mode",r.isLine?"line":"basic"),1!=r.loginType){t.next=21;break}return t.next=17,r.getBCstatus(r.loginData);case 17:e=t.sent,r.testLog("login",e),t.next=22;break;case 21:e={rtcode:"0"};case 22:t.t0=e.rtcode,t.next="0"===t.t0?25:52;break;case 25:if(!r.isLine){t.next=31;break}return t.next=28,r.setQuestionWF09(r.wf09Data);case 28:t.t1=t.sent,t.next=34;break;case 31:return t.next=33,r.setNewWF09(r.wf09Data);case 33:t.t1=t.sent;case 34:if(n=t.t1,r.testLog((r.isLine?"line-":"")+"wf09",n),"1"!=n.status.toString()){t.next=50;break}return t.next=39,r.setDiscount("2020new-year",r.disData);case 39:if(i=t.sent,r.testLog("dis",i),"0"!=i.rtcode.toString()){t.next=46;break}r.isDone=!0,r.$nextTick(function(){r.$scrollTo("#item2-tab")}),t.next=48;break;case 46:return r.throwError("\u6b64\u6d3b\u52d5\u8207\u672c\u516c\u53f8LINE\u5b98\u65b9\u5e33\u865f\u300c\u60c5\u4eba\u7bc0\u9650\u5b9a-\u5fc3\u8aa0\u6298\u9748\u300d\u5c6c\u76f8\u540c\u6d3b\u52d5\uff0c\u512a\u60e0\u6bcf\u4eba\u50c5\u9650\u53d6\u5f97\u4e00\u6b21\uff0c\u4e0d\u5f97\u91cd\u8907\u9818\u53d6\u5594\uff01",i),t.abrupt("return");case 48:t.next=51;break;case 50:r.throwError(n.memo,n);case 51:return t.abrupt("break",54);case 52:return r.throwError(e.message,e),t.abrupt("break",54);case 54:t.next=59;break;case 56:t.prev=56,t.t2=t.catch(12),r.throwError("\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01",t.t2);case 59:return t.prev=59,r.isSubmit=!1,t.finish(59);case 62:case"end":return t.stop()}},t,r,[[12,56,59,62]])}))()},lineAlert:function(){alert("\u7533\u8acbLINE\u5b98\u65b9\u5e33\u865f\u7d81\u5b9a\u670d\u52d9\u6642\uff0c\u5bcc\u862d\u514b\u6797\u5c07\u6839\u64da\u4f60\u63d0\u4f9b\u7684\u59d3\u540d\u3001\u884c\u52d5\u96fb\u8a71\u8207LINE\u5e33\u865f\u9032\u884c\u8eab\u5206\u9a57\u8b49\uff0c\u672c\u67e5\u8a62\u53ca\u9a57\u8b49\u670d\u52d9\u65bc\u5bcc\u862d\u514b\u6797\u7cfb\u7d71\u57f7\u884c\uff0c\u4e0d\u6703\u7d93\u7531LINE\u8a18\u9304\u8cc7\u6599\u3002\n\n\u6210\u529f\u7d81\u5b9a\u500b\u4eba\u5316\u670d\u52d9\u5f8c\uff0c \u82e5\u66f4\u63db\u624b\u6a5f\u6216\u91cd\u65b0\u5b89\u88ddLINE APP\uff0c \u9700\u4ee5\u539f\u672cLINE ID\u767b\u5165\uff0c \u4ee5\u5229\u5f8c\u7e8cLINE\u500b\u4eba\u5316\u670d\u52d9\u4f7f\u7528\u3002 ")}}};