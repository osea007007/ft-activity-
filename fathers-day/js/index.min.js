"use strict";function _asyncToGenerator(t){return function(){var a=t.apply(this,arguments);return new Promise(function(o,s){return function e(t,n){try{var i=a[t](n),r=i.value}catch(t){return void s(t)}if(!i.done)return Promise.resolve(r).then(function(t){e("next",t)},function(t){e("throw",t)});o(r)}("next")})}}Vue.use(window.vuelidate.default),Vue.use(VueScrollTo),Vue.component("form-post",{props:{form:{type:Object,required:!0},uid:{type:String,defalut:""},testMode:{type:Boolean,defalut:!1}},data:function(){return{landing:"online"}},template:'\n    <form :action="action" method="post" ref="formTemplate">\n      <input type="text" name="line_id" :value="uid" />\n      <input type="text" name="line-id" :value="uid" />\n      <input type="text" name="BF_NAME" :value="form.BF_NAME" />\n      <input type="text" name="CELL_PHONE" :value="form.CELL_PHONE" />\n      <input type="text" name="EMAIL" :value="form.EMAIL" />\n    </form>\n  ',computed:{action:function(){var t="";switch(this.landing){case"choice":t=this.testMode?"https://wt.franklin.com.tw:8081/Open/Entrance":"https://etrade.franklin.com.tw/Open/Entrance";break;case"send":t=this.testMode?"https://wt.franklin.com.tw:8081/Open/NewMember?so=Online&":"https://etrade.franklin.com.tw/Open/NewMember?so=Online&";break;case"online":t=this.testMode?"https://wt.franklin.com.tw:8081/Open/OpenOnlineAuthenticated?":"https://etrade.franklin.com.tw/Open/OpenOnlineAuthenticated?"}return t}},methods:{formSubmit:function(t){var e=this;this.landing=t,this.$nextTick(function(){e.$refs.formTemplate.submit()})}}}),Vue.component("test-btn",{data:function(){return{styles:{position:"fixed",top:0,width:"100%",display:"flex",justifyContent:"center"},btnStyles:{color:"black",margin:"0 5px"}}},template:'\n  <div class="testBtn" :style="styles">\n    <button :style="btnStyles" @click.prevent="$emit(\'test\', \'2020-08-09 00:00:00\')">\u7b2c\u4e00\u968e\u6bb5</button>\n    <button :style="btnStyles" @click.prevent="$emit(\'test\', \'2020-07-09 00:00:00\')">\u6d3b\u52d5\u7d50\u675f</button>\n  </div>'});var front={mixins:[valid,window.lineEvent],data:function(){return{config:{event_id:"D2459",event_code:"fathers-day",line_binding:"202008fathersday",discount_code:"2020fathersday",start_date:"2020-08-04 18:00:00",end_date:"2020-08-09 00:00:00",uid:"",t:"",hash:"",isBinded:999},isSubmit:!1,isDone:!1,loginType:2,temp:{ID_NO:"",BF_NAME:"",CELL_PHONE:"",EMAIL:""},form:{ID_NO:"",PASS_WORD:"",BF_NAME:"",CELL_PHONE:"",EMAIL:"",AGREE:!1}}},computed:{login_id_no:{get:function(){return this.form.ID_NO},set:function(t){this.form.ID_NO=t?t.toUpperCase():""}},covered_id_no:function(){var t="";return this.form.ID_NO&&(t=this.form.ID_NO.substr(0,3)+"XXXXX"+this.form.ID_NO.substr(8,10)),t},event_url:function(){return this.testMode?"https://line.franklin.com.tw:8443/Tag/Bind/DR?id="+this.config.line_binding:"https://line.franklin.com.tw:8843/Tag/Bind/DR?id="+this.config.line_binding},isLine:function(){return"linem"==this.getQueryParams().utm_source},wf09Data:function(){var t={Event_Id:this.config.event_id,IsRepeatable:"N"};return this.getQueryParams().utm_source&&(t.utm_source=this.getQueryParams().utm_source),this.isLine&&(t.uid=this.config.uid),1==this.config.isBinded?t.Identification="":(t.Identification=this.form.ID_NO==this.temp.ID_NO?"":this.form.ID_NO,1==this.loginType?t.Event_Other="-1":2==this.loginType&&(t.Friend_Name=this.form.BF_NAME==this.temp.BF_NAME?"":this.form.BF_NAME,t.Email=this.form.EMAIL==this.temp.EMAIL?"":this.form.EMAIL,t.M_Tel=this.form.CELL_PHONE==this.temp.CELL_PHONE?"":this.form.CELL_PHONE)),t},disData:function(){return{ID_NO:this.form.ID_NO,CELL_PHONE:this.form.CELL_PHONE,BF_NAME:this.form.BF_NAME,EMAIL:this.form.EMAIL,AGREE:this.form.AGREE?"Y":""}},isPart2:function(){return moment(new Date).isSameOrAfter(this.config.end_date)},isEnd:function(){return!1}},created:function(){this.isEnd?location.href="https://event.franklin.com.tw/activityEnds/event-end.html":(this.config.event_id=this.isPart2?"D2460":"D2459",this.isLine&&!this.isEnd&&this.checkLineParams())},methods:{open:function(t){this.$refs.formPost.formSubmit(t)},test:function(t){var e=this;this.config.end_date=t,this.$nextTick(function(){e.config.event_id=e.isPart2?"D2460":"D2459"})},checkLineParams:function(){var t=this;this.checkParams(this.config.event_code,function(){t.getInfo(),t.testLog("url","https://wt.franklin.com.tw/areas/"+t.config.event_code+"/index.html?utm_source="+t.getQueryParams().utm_source+"&uid="+t.config.uid+"&t="+t.config.t+"&hash="+t.config.hash)})},getInfo:function(){var o=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,i,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!o.isSubmit){t.next=2;break}return t.abrupt("return");case 2:return o.isSubmit=!0,t.prev=3,t.prev=4,t.next=7,o.getLineVerify({uid:o.config.uid,timestamp:o.config.t,hash:o.config.hash});case 7:if(e=t.sent,o.testLog("verify",e),!e){t.next=19;break}return t.next=12,o.getBinded_2({CodeSecret:md5(o.config.uid+"D2444"),UID:o.config.uid});case 12:n=t.sent,o.testLog("bind",n),i=[1,2,4],o.config.isBinded=-1<i.indexOf(n.status)?n.status:4,o.$nextTick(function(){1==o.config.isBinded?o.form.ID_NO=n.memo:2==o.config.isBinded&&(o.temp.ID_NO=n.memo||"",o.temp.BF_NAME=n.Friend_Name||"",o.temp.CELL_PHONE=n.M_Tel||"",o.temp.EMAIL=n.Email||"",o.form.ID_NO=n.memo||"",o.form.BF_NAME=n.Friend_Name||"",o.form.CELL_PHONE=n.M_Tel||"",o.form.EMAIL=n.Email||"")}),t.next=20;break;case 19:location.href=o.event_url;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(4),r=t.t0?t.t0:"\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01",o.throwError(r+" info",""+t.t0);case 26:t.next=31;break;case 28:t.prev=28,t.t1=t.catch(3),o.throwError("\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01 other",t.t1);case 31:return t.prev=31,o.isSubmit=!1,t.finish(31);case 34:case"end":return t.stop()}},t,o,[[3,28,31,34],[4,22]])}))()},sendForm:function(){var r=this;return _asyncToGenerator(regeneratorRuntime.mark(function t(){var e,n,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.isEnd){t.next=3;break}return alert("\u6b64\u6d3b\u52d5\u5df2\u7d93\u7d50\u675f\uff0c\u672a\u4f86\u5c07\u4e0d\u5b9a\u671f\u63d0\u4f9b\u66f4\u591a\u6700\u5373\u6642\u7684\u5e02\u5834\u3001\u597d\u5eb7\u8a0a\u606f\uff0c\u8acb\u6301\u7e8c\u95dc\u6ce8\u6211\u5011\u5594\uff01"),t.abrupt("return");case 3:if(!r.$v.form.$invalid){t.next=8;break}r.$v.form.$touch(),r.$nextTick(function(){var t=document.querySelectorAll(".formArea-item.error")[0];r.$scrollTo(t)}),t.next=60;break;case 8:if(!r.isSubmit){t.next=10;break}return t.abrupt("return");case 10:return r.isSubmit=!0,t.next=13,new Promise(function(t){r.$nextTick(function(){setTimeout(function(){if(r.localMode)return r.isLine&&(r.form.BF_NAME="",r.form.CELL_PHONE="",r.form.EMAIL=""),void r.done("#complete");t()},333)})});case 13:t.prev=13,r.testLog("mode",r.isLine?"line":"basic"),e={rtcode:"0"},t.t0=e.rtcode,t.next="0"===t.t0?19:50;break;case 19:if(!r.isLine){t.next=25;break}return t.next=22,r.setQuestionWF09(r.wf09Data);case 22:t.t1=t.sent,t.next=28;break;case 25:return t.next=27,r.setNewWF09(r.wf09Data);case 27:t.t1=t.sent;case 28:if(n=t.t1,r.testLog((r.isLine?"line-":"")+"wf09",n),"1"!=n.status.toString()){t.next=48;break}if(!r.isPart2){t.next=35;break}return r.isLine&&(r.form.BF_NAME="",r.form.CELL_PHONE="",r.form.EMAIL=""),r.done("#complete"),t.abrupt("return");case 35:return t.next=37,r.setDiscount(r.config.discount_code,r.disData);case 37:if(i=t.sent,r.testLog("dis",i),"0"!=i.rtcode.toString()){t.next=44;break}r.isLine&&(r.form.BF_NAME="",r.form.CELL_PHONE="",r.form.EMAIL=""),r.done("#complete"),t.next=46;break;case 44:return r.throwError(i.message,i),t.abrupt("return");case 46:t.next=49;break;case 48:r.throwError(n.memo,n);case 49:return t.abrupt("break",52);case 50:return r.throwError(e.message,e),t.abrupt("break",52);case 52:t.next=57;break;case 54:t.prev=54,t.t2=t.catch(13),r.throwError("\u7cfb\u7d71\u7e41\u5fd9\uff0c\u8acb\u7a0d\u5019\u518d\u8a66\uff0c\u8b1d\u8b1d\uff01",t.t2);case 57:return t.prev=57,r.isSubmit=!1,t.finish(57);case 60:case"end":return t.stop()}},t,r,[[13,54,57,60]])}))()},done:function(t){var e=this;this.isDone=!0,this.$nextTick(function(){e.$scrollTo(t)})},lineAlert:function(){alert("\u7533\u8acbLINE\u5b98\u65b9\u5e33\u865f\u7d81\u5b9a\u670d\u52d9\u6642\uff0c\u5bcc\u862d\u514b\u6797\u5c07\u6839\u64da\u4f60\u63d0\u4f9b\u7684\u59d3\u540d\u3001\u884c\u52d5\u96fb\u8a71\u8207LINE\u5e33\u865f\u9032\u884c\u8eab\u5206\u9a57\u8b49\uff0c\u672c\u67e5\u8a62\u53ca\u9a57\u8b49\u670d\u52d9\u65bc\u5bcc\u862d\u514b\u6797\u7cfb\u7d71\u57f7\u884c\uff0c\u4e0d\u6703\u7d93\u7531LINE\u8a18\u9304\u8cc7\u6599\u3002\n\n\u6210\u529f\u7d81\u5b9a\u500b\u4eba\u5316\u670d\u52d9\u5f8c\uff0c \u82e5\u66f4\u63db\u624b\u6a5f\u6216\u91cd\u65b0\u5b89\u88ddLINE APP\uff0c \u9700\u4ee5\u539f\u672cLINE ID\u767b\u5165\uff0c \u4ee5\u5229\u5f8c\u7e8cLINE\u500b\u4eba\u5316\u670d\u52d9\u4f7f\u7528\u3002 ")}}};